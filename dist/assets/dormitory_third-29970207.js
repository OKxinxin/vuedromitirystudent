import{_ as w,o as u,c,b as d,w as s,E as C,e as E,f as v,g as n,a as I,F as _,r as y,m as D,h as F,j as A,i as N,k as x}from"./index-f8789b21.js";import{E as L,a as U}from"./el-select-778a89da.js";import{f as W,h as B,b as T,i as j,j as z,k as q}from"./DormitoryManagement-1064e5d8.js";import"./validator-0b020f7f.js";const O={data(){return{dormitoryStudents:[],students:[],dormitories:[],dialogFormVisible:!1,transferDialogVisible:!1,dorID:0,Student:{studentName:"",studentId:"",dormitoryId:""},selectedStudent:{studentId:"",dormitoryId:""},formLabelWidth:"80px"}},mounted(){this.getAllDormitoryStudents(),this.getAllStudents(),this.getAllDormitories(),this.dorID=parseInt(this.$route.query.id)},methods:{getAllDormitoryStudents(){W().then(e=>{console.log(e);const t=e.data.dormitoryStudents;console.log("this.dorID",this.dorID),this.dormitoryStudents=t.filter(h=>h.dormitoryId===parseInt(this.dorID))}).catch(e=>{console.log(e)})},getAllStudents(){B().then(e=>{console.log(e),e&&e.data&&e.data.students&&(this.students=e.data.students)}).catch(e=>{console.log(e)})},getAllDormitories(){T().then(e=>{console.log(e),e&&e.data&&e.data.dormitories&&(this.dormitories=e.data.dormitories)}).catch(e=>{console.log(e)})},addDormitoryStudent(){this.dialogFormVisible=!0,this.clearForm()},save(){j(this.Student).then(e=>{console.log(e),e&&e.code===1?(this.dialogFormVisible=!1,this.clearForm(),this.getAllDormitoryStudents()):this.$message({type:"error",message:"添加失败"})}).catch(e=>{console.log(e)})},clearForm(){this.Student={studentName:"",studentId:"",dormitoryId:this.dorID}},toEdit(e){this.selectedStudent.studentId=e.studentId,this.selectedStudent.dormitoryId=e.dormitoryId,this.selectedStudent.id=e.id,this.transferDialogVisible=!0},saveTransferStudent(){const e={dormitoryId:this.selectedStudent.dormitoryId,id:this.selectedStudent.id,studentId:this.selectedStudent.studentId};console.log("transferData:",e),z(e).then(t=>{console.log(t),t?(this.transferDialogVisible=!1,this.getAllDormitoryStudents()):console.error("迁移失败")}).catch(t=>{console.error(t)})},del(e){q(e).then(t=>{console.log(t),t&&t.code===1?this.getAllDormitoryStudents():this.$message({type:"error",message:"删除失败"})}).catch(t=>{console.log(t)})},updateStudentId(){const e=this.students.find(t=>t.studentName===this.Student.studentName);e?this.Student.studentId=e.id:this.Student.studentId=""}}},G={class:"dialog-footer"},H={class:"dialog-footer"};function J(e,t,h,K,o,r){const i=C,m=F,V=E,p=L,b=U,a=A,f=N,g=x,S=v;return u(),c("div",null,[d(i,{type:"warning",onClick:r.addDormitoryStudent},{default:s(()=>[n("添加学生")]),_:1},8,["onClick"]),d(V,{data:o.dormitoryStudents,style:{width:"100%"}},{default:s(()=>[d(m,{fixed:"",prop:"id",label:"ID",width:"150"}),d(m,{prop:"dormitoryId",label:"宿舍ID",width:"120"}),d(m,{prop:"studentId",label:"学生ID",width:"120"}),d(m,{fixed:"right",label:"功能管理",width:"120"},{default:s(l=>[d(i,{link:"",type:"primary",size:"small",onClick:k=>r.toEdit(l.row)},{default:s(()=>[n("迁移")]),_:2},1032,["onClick"]),d(i,{link:"",type:"primary",size:"small",onClick:k=>r.del(l.row.id)},{default:s(()=>[n("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),d(S,{modelValue:o.dialogFormVisible,"onUpdate:modelValue":t[4]||(t[4]=l=>o.dialogFormVisible=l),title:"添加学生"},{footer:s(()=>[I("span",G,[d(i,{onClick:t[3]||(t[3]=l=>o.dialogFormVisible=!1)},{default:s(()=>[n("取消")]),_:1}),d(i,{type:"primary",onClick:r.save},{default:s(()=>[n("添加")]),_:1},8,["onClick"])])]),default:s(()=>[d(g,{model:o.Student},{default:s(()=>[d(a,{label:"姓名","label-width":o.formLabelWidth},{default:s(()=>[d(b,{modelValue:o.Student.studentName,"onUpdate:modelValue":t[0]||(t[0]=l=>o.Student.studentName=l),placeholder:"请选择学生姓名",onChange:r.updateStudentId},{default:s(()=>[(u(!0),c(_,null,y(o.students,l=>(u(),D(p,{key:l.id,label:`${l.studentName}（${l.classinfo}）`,value:l.studentName},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1},8,["label-width"]),d(a,{label:"学生ID","label-width":o.formLabelWidth},{default:s(()=>[d(f,{modelValue:o.Student.studentId,"onUpdate:modelValue":t[1]||(t[1]=l=>o.Student.studentId=l),autocomplete:"off",disabled:!0},null,8,["modelValue"])]),_:1},8,["label-width"]),d(a,{label:"宿舍ID","label-width":o.formLabelWidth},{default:s(()=>[d(f,{modelValue:o.Student.dormitoryId,"onUpdate:modelValue":t[2]||(t[2]=l=>o.Student.dormitoryId=l),autocomplete:"off",disabled:!0},null,8,["modelValue"])]),_:1},8,["label-width"])]),_:1},8,["model"])]),_:1},8,["modelValue"]),d(S,{modelValue:o.transferDialogVisible,"onUpdate:modelValue":t[8]||(t[8]=l=>o.transferDialogVisible=l),title:"迁移学生"},{footer:s(()=>[I("span",H,[d(i,{onClick:t[7]||(t[7]=l=>o.transferDialogVisible=!1)},{default:s(()=>[n("取消")]),_:1}),d(i,{type:"primary",onClick:r.saveTransferStudent},{default:s(()=>[n("迁移")]),_:1},8,["onClick"])])]),default:s(()=>[d(g,{model:o.selectedStudent},{default:s(()=>[d(a,{label:"学生ID","label-width":o.formLabelWidth},{default:s(()=>[d(f,{modelValue:o.selectedStudent.studentId,"onUpdate:modelValue":t[5]||(t[5]=l=>o.selectedStudent.studentId=l),autocomplete:"off",disabled:!0},null,8,["modelValue"])]),_:1},8,["label-width"]),d(a,{label:"宿舍ID","label-width":o.formLabelWidth},{default:s(()=>[d(b,{modelValue:o.selectedStudent.dormitoryId,"onUpdate:modelValue":t[6]||(t[6]=l=>o.selectedStudent.dormitoryId=l),placeholder:"请选择宿舍ID"},{default:s(()=>[(u(!0),c(_,null,y(o.dormitories,l=>(u(),D(p,{key:l.id,label:l.id,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label-width"])]),_:1},8,["model"])]),_:1},8,["modelValue"])])}const X=w(O,[["render",J]]);export{X as default};
